# Project Nexus: Frontend PRD (Phase 1-3)

## æ€»ä½“æ¶æ„ç­–ç•¥

å‰ç«¯ä¸å†æ˜¯ç®€å•çš„â€œæ¶ˆæ¯åˆ—è¡¨â€ï¼Œè€Œæ˜¯ä¸€ä¸ª **â€œååº”å¼å®¹å™¨â€ (Reactive Container)**ã€‚å®ƒé€šè¿‡ SSE ç›‘å¬åç«¯ä¿¡å·ï¼ŒåŠ¨æ€ç”Ÿæˆ UI ç»„ä»¶ã€‚

* **Source of Truth**: åç«¯ Director (é€šè¿‡ `event: meta` ä¸‹å‘æŒ‡ä»¤)ã€‚
* **Data Flow**: å•å‘æ•°æ®æµ (Server -> Client)ã€‚
* **State Management**: ä½¿ç”¨ Map ç»“æ„å­˜å‚¨ `Record<AgentId, Content>`ï¼Œæ”¯æŒå¹¶å‘å†™å…¥ã€‚

---

## ğŸ“‹ Phase 1: æ ¸å¿ƒå¼•æ“ä¸æ•°æ®ç®¡é“ (The Engine Core)

**ç›®æ ‡**: è·‘é€š `POST /api/v1/engine` æ¥å£ï¼Œå®ç°â€œå¯¼æ¼”ç¼–æ’â€å’Œâ€œå¤šè·¯å¹¶å‘æµâ€çš„åº•å±‚é€»è¾‘ã€‚æ­¤æ—¶ä¸è¿½æ±‚ UI ç¾è§‚ï¼Œåªè¿½æ±‚æ•°æ®æ­£ç¡®ä¸Šå±ã€‚

### 1. åŠŸèƒ½éœ€æ±‚ (Functional Requirements)

#### 1.1 SSE è¿æ¥ç®¡ç†å™¨ (Connection Manager)

* **å»ºç«‹è¿æ¥**: ç”¨æˆ·æäº¤ Query åï¼Œé€šè¿‡ `@microsoft/fetch-event-source` å‘èµ· POST è¯·æ±‚ã€‚
* **ç”Ÿå‘½å‘¨æœŸç®¡ç†**: å¤„ç† `onopen`, `onmessage`, `onclose`, `onerror`ã€‚
* **Paylaod ç»„è£…**: æ„é€ ç¬¦åˆ `PolymathRequest` æ¥å£çš„ JSON Body (åŒ…å« `mode: 'polymath'` å’Œ `query`)ã€‚

#### 1.2 å¯¼æ¼”ç¼–æ’ç³»ç»Ÿ (The Director Logic)

* **ç›‘å¬ `event: meta**`:
* è¿™æ˜¯æœ€é‡è¦çš„ä¿¡å·ã€‚å‰ç«¯æ”¶åˆ°æ­¤äº‹ä»¶åï¼Œå¿…é¡»ç«‹å³æ¸…ç©º/é‡ç½®å½“å‰çš„ Agent åˆ—è¡¨ã€‚
* æ ¹æ® `selected_agents` æ•°ç»„ï¼ˆä¾‹å¦‚ `['historian', 'critic']`ï¼‰ï¼Œåœ¨å†…å­˜ä¸­åˆå§‹åŒ–å¯¹åº”çš„æ•°æ®ç»“æ„ã€‚
* **UI å“åº”**: ç•Œé¢ä¸Šä»â€œç©ºçŠ¶æ€â€ç¬é—´åˆ‡æ¢ä¸ºâ€œN ä¸ªå ä½å¡ç‰‡â€ã€‚



#### 1.3 å¹¶å‘æµå¼å†™å…¥ (Concurrent Streaming)

* **ç›‘å¬ `event: stream**`:
* è§£æ `data.agent` (ç›®æ ‡ ID) å’Œ `data.delta` (å¢é‡æ–‡æœ¬)ã€‚
* **æ— é”å†™å…¥**: æ ¹æ® ID å®šä½åˆ°å¯¹åº”çš„ State å¯¹è±¡ï¼Œè¿½åŠ æ–‡æœ¬ã€‚å¿…é¡»æ”¯æŒå¤šä¸ª Agent åœ¨åŒä¸€æ¯«ç§’å†…æ›´æ–°ï¼ˆä¾‹å¦‚ Critic å’Œ Historian åŒæ—¶åœ¨è¯´è¯ï¼‰ã€‚


* **ç›‘å¬ `event: stream_end**`:
* å°†å¯¹åº” Agent çš„çŠ¶æ€ä» `streaming` æ ‡è®°ä¸º `done`ã€‚



### 2. æ•°æ®ç»“æ„å®šä¹‰ (TypeScript)

```typescript
// æ ¸å¿ƒçŠ¶æ€ Store (Zustand æ¨è)
interface PolymathStore {
  stage: 'idle' | 'orchestrating' | 'streaming' | 'finished';
  agents: Record<string, {
    id: string;      // e.g., 'critic'
    name: string;    // e.g., 'æ‰¹åˆ¤è€…'
    content: string; // Markdown æ–‡æœ¬
    isDone: boolean; // æ˜¯å¦æ”¶åˆ° stream_end
  }>;
  actions: {
    initAgents: (ids: string[]) => void;
    appendContent: (id: string, delta: string) => void;
    markDone: (id: string) => void;
  }
}

```

---

## ğŸ¨ Phase 2: æ™ºèƒ½ä½“è§’è‰²ä¸åŠ¨æ€èˆå° (Agent Persona & Stage)

**ç›®æ ‡**: å°† Phase 1 çš„çº¯æ–‡æœ¬æ•°æ®è½¬åŒ–ä¸º **2D å…¨æ¯å¡ç‰‡ (Holo-Cards)**ï¼Œå®ç°ä¸åŒ Agent çš„è§†è§‰åŒºåˆ†å’ŒåŠ¨æ€å¸ƒå±€ã€‚

### 1. è§†è§‰è§„èŒƒ (Visual Specs)

#### 1.1 åŠ¨æ€ç½‘æ ¼å¸ƒå±€ (Dynamic Grid)

æ ¹æ® `event: meta` è¿”å›çš„ `selected_agents` æ•°é‡ï¼ŒåŠ¨æ€è®¡ç®— CSS Gridï¼š

* **1 Agent**: å±…ä¸­å®½å¡ç‰‡ (max-width: 600px)ã€‚
* **2 Agents**: å·¦å³åˆ†æ  (Split View)ï¼Œå¦‚ä¹‹å‰çš„è®¾è®¡å›¾ã€‚
* **3 Agents**: "å“"å­—å½¢å¸ƒå±€æˆ–ä¸‰åˆ—å¸ƒå±€ã€‚
* **4+ Agents**: 2x2 ç½‘æ ¼ã€‚

#### 1.2 è§’è‰²ä¸»é¢˜æ˜ å°„ (Persona Mapping)

æ ¹æ®åç«¯æä¾›çš„ Agent ID åˆ—è¡¨ï¼Œå‰ç«¯éœ€ç¡¬ç¼–ç ä¸€å¥—è§†è§‰ä¸»é¢˜é…ç½®ï¼š

| Agent ID | æ˜¾ç¤ºåç§° | ä¸»é¢˜è‰² (Tailwind) | å›¾æ ‡ (Lucide) | è¾¹æ¡†é£æ ¼ |
| --- | --- | --- | --- | --- |
| `critic` | æ‰¹åˆ¤è€… | `rose-500` | `AlertTriangle` | çº¢è‰²è„‰å†²è¾¹æ¡† |
| `historian` | å†å²å­¦å®¶ | `amber-500` | `ScrollText` | ç¥ç€è‰²å¤å¤å…‰æ™• |
| `pragmatist` | å®å¹²å®¶ | `emerald-500` | `Briefcase` | ç»¿è‰²ç¨³é‡å®çº¿ |
| `expander` | æ‹“å±•è€… | `purple-500` | `Sparkles` | ç´«è‰²æ‰©æ•£å…‰æ•ˆ |
| `verifier` | éªŒè¯è€… | `blue-500` | `ShieldCheck` | è“è‰²ç›¾ç‰Œæ‰«æ |
| `mediator` | è°ƒåœè€… | `slate-400` | `Scale` (å¤©å¹³) | ç°è‰²å¹³è¡¡çº¿ |

#### 1.3 å¡ç‰‡çŠ¶æ€æœº UI

* **Thinking (ç­‰å¾…æµ)**: å¡ç‰‡å·²ç”Ÿæˆï¼Œå†…å®¹ä¸ºç©ºã€‚æ˜¾ç¤º "Connecting Quantum Core..." çš„éª¨æ¶å±åŠ¨ç”»ã€‚
* **Streaming (è¾“å‡ºä¸­)**: æ–‡å­—æ‰“å­—æœºæ•ˆæœã€‚å¡ç‰‡è¾¹ç¼˜å‘¼å¸å‘å…‰ã€‚
* **Done (å®Œæˆ)**: å…‰æ•ˆæ”¶æ•›ï¼Œæ˜¾ç¤º Token ç»Ÿè®¡æˆ–å¼•ç”¨æ¥æºã€‚
* **Error (æ•…éšœ)**: ç›‘å¬ `event: error`ã€‚å¡ç‰‡å˜çº¢ï¼Œæ˜¾ç¤ºæ•…éšœä»£ç æ•ˆæœ (Glitch Effect)ã€‚

### 2. äº¤äº’ç»†èŠ‚

* **è‡ªåŠ¨æ»šåŠ¨**: æ¯ä¸ªå¡ç‰‡ç‹¬ç«‹æ»šåŠ¨ï¼Œä½†å½“æœ‰æ–°å†…å®¹ç”Ÿæˆæ—¶ï¼Œè‡ªåŠ¨å¸åº• (Auto-scroll to bottom)ã€‚
* **Markdown æ¸²æŸ“**: å¿…é¡»æ”¯æŒåŸºç¡€ Markdown (åŠ ç²—ã€åˆ—è¡¨) çš„å®æ—¶æ¸²æŸ“ï¼Œé˜²æ­¢æµå¼è¾“å‡ºæ—¶çš„æ ¼å¼æŠ–åŠ¨ã€‚

---

## âš™ï¸ Phase 3: å¤–å›´æ§åˆ¶ä¸æŒä¹…åŒ– (Peripherals & Control)

**ç›®æ ‡**: å®Œå–„ `history` ä¸Šä¸‹æ–‡æ”¯æŒï¼Œå¢åŠ é…ç½®èƒ½åŠ›ï¼Œæå‡äº§å“çš„å®Œæ•´æ€§ã€‚

### 1. åŠŸèƒ½éœ€æ±‚

#### 1.1 å†å²ä¸Šä¸‹æ–‡æ³¨å…¥ (Context Injection)

* **é€»è¾‘**: åç«¯æ¥å£è¦æ±‚ `history` å­—æ®µã€‚
* **å®ç°**: å‰ç«¯éœ€è¦ç»´æŠ¤ä¸€ä¸ª `SessionHistory` æ•°ç»„ã€‚
* **æµç¨‹**: æ¯æ¬¡å‘èµ·è¯·æ±‚æ—¶ï¼Œå°†å½“å‰ä¼šè¯ä¹‹å‰çš„é—®ç­”å¯¹ï¼ˆUser Query + Assistant Final Summaryï¼‰æ‰“åŒ…æ”¾å…¥ `body.history`ã€‚

#### 1.2 é…ç½®é¢æ¿ (Config Panel)

* **å¯¹åº”å­—æ®µ**: `config.model`ã€‚
* **UI**: åœ¨ Input æ¡†å³ä¾§å¢åŠ  "God Mode" è®¾ç½®æŒ‰é’®ã€‚
* **é€‰é¡¹**: ä¸‹æ‹‰èœå•é€‰æ‹©åº•å±‚æ¨¡å‹ (e.g., "Speed (Flash)" vs "Intelligence (Pro)")ã€‚

#### 1.3 é”™è¯¯æ¢å¤æœºåˆ¶ (Resilience)

* **ç½‘ç»œä¸­æ–­**: SSE è¿æ¥æ„å¤–æ–­å¼€æ—¶ï¼Œå‰ç«¯åº”ä¿ç•™å·²æ¥æ”¶çš„å†…å®¹ï¼Œå¹¶åœ¨å¡ç‰‡åº•éƒ¨æ˜¾ç¤º "Connection Lost. Retry?" æŒ‰é’®ã€‚
* **Agent å•ç‚¹æ•…éšœ**: å¦‚æœæ”¶åˆ° `event: error` (ä¾‹å¦‚ Critic æŒ‚äº†)ï¼Œä¸è¦è®©æ•´ä¸ªé¡µé¢å´©æºƒã€‚åªå°† Critic å¡ç‰‡ç½®ç°å¹¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œå…¶ä»– Agent ç»§ç»­è¿è¡Œã€‚

#### 1.4 ç»¼åˆè€…è§†å›¾ (The Synthesizer)

* **ç‰¹æ®Šé€»è¾‘**: å¦‚æœ `selected_agents` ä¸­åŒ…å« `synthesizer`ï¼Œé€šå¸¸å®ƒæ˜¯æœ€åä¸€ä¸ªå‡ºåœºçš„ã€‚
* **UI å¤„ç†**: å°† `synthesizer` çš„å¡ç‰‡è®¾è®¡ä¸º **å…¨å®½ (Full Width)**ï¼Œç½®äºæ‰€æœ‰å…¶ä»–å¡ç‰‡ä¸‹æ–¹ï¼Œä½œä¸ºæœ€ç»ˆçš„â€œä¼šè®®æ€»ç»“æŠ¥å‘Šâ€ã€‚

---

### å¼€å‘ä¼˜å…ˆçº§å»ºè®®

1. **P0**: å®ç° **SSE Client** å’Œ **Zustand Store**ï¼Œç¡®ä¿èƒ½æ”¶åˆ° `meta` å’Œ `stream` äº‹ä»¶å¹¶åœ¨æ§åˆ¶å°æ‰“å°æ­£ç¡®ã€‚
2. **P0**: å®ç°åŸºç¡€çš„ **HoloCard** ç»„ä»¶ï¼Œä¸å¸¦é¢œè‰²åŒºåˆ†ï¼Œåªæ˜¾ç¤ºæ–‡æœ¬ã€‚
3. **P1**: å®ç° **Director åŠ¨æ€å¸ƒå±€**ï¼Œæ ¹æ® `meta` äº‹ä»¶ç”Ÿæˆå¯¹åº”æ•°é‡çš„å¡ç‰‡ã€‚
4. **P1**: å¼•å…¥ **Persona ä¸»é¢˜ç³»ç»Ÿ**ï¼Œç»™ä¸åŒ ID ä¸Šè‰²ã€‚
5. **P2**: æ¥å…¥ **History** å’Œ **Config** å‚æ•°ã€‚